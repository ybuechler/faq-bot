<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Kundenchat</title>
<style>
* {
    box-sizing: border-box;
}

.navbar {
display: none;
}



.css-table {
    width: 100%;
}

.css-table button.btn-link.clicked::after {
    content: "✓";
    color: #28a745; 
    font-weight: 700;
    margin-left: 6px; 
}

.css-table button.btn-link {
    display: inline-block;
    background: linear-gradient(135deg, #0090d4, #0078b0);
    color: #fff;
    padding: 8px 16px;
    border-radius: 8px;
    font-weight: 600;
    text-decoration: none;
    box-shadow: 0 2px 8px rgba(0, 144, 212, 0.3);
    transition: all 0.3s ease;
    border: none;
    cursor: pointer;
width: 170px;
}

.css-table button.btn-link:hover,
.css-table button.btn-link:focus {
    background: linear-gradient(135deg, #0078b0, #006897);
    box-shadow: 0 4px 12px rgba(0, 144, 212, 0.4);
    transform: translateY(-1px);
}

.css-table button.btn-link:active {
    transform: translateY(0);
}

.css-table tbody tr + tr td {
    border-top: 1px solid #e5f3fa;
}

.css-table thead tr {
    border-bottom: 2px solid #00A4E0;
}

.css-table th,
.css-table td {
    text-align: left;
    vertical-align: top;
}

.post-icon {
    background-image: url(data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHhtbDpzcGFjZT0icHJlc2VydmUiIGNsYXNzPSJjLWhlYWRlci1sb2dvX19zdmciIHZpZXdCb3g9IjAgMCA2OCAyOSI+PGcgZmlsbD0iIzAwQTRFMCI+PHBhdGggZD0iTTM2LjkzIDIzLjY5Yy0yLjIzIDAtNC40OS0xLjQ2LTYuMDctMi41MWE4LjU0IDguNTQgMCAwIDAtNC44Ni0xLjdjLTEuOC4wNy0zLjU1LjY3LTUgMS43NC0xLjc5IDEuMDktMy41NyAyLjM5LTcgMi4zOS01LjgzIDAtOS4xNS00LTkuMTUtOS41NmE4LjkyMyA4LjkyMyAwIDAgMSA4LjU0LTkuM2MuMTUtLjAxLjMxLS4wMS40Ni0uMDEgMi42OC0uMTQgNS4zMS43OCA3LjMzIDIuNTVsMi42Ny0zLjgxYy0yLjgtMi4zNC02LjM1LTMuNTctMTAtMy40OEM2LjMtLjEuMSA1LjkzIDAgMTMuNDh2LjU3YzAgOC4zNCA1LjcxIDE0LjMgMTQgMTQuMyAyLjc3LS4wMyA1LjQ3LS44NCA3Ljc5LTIuMzUgMS4zMy0uODUgMi41OS0xLjg3IDQtMS44N3MyLjE0LjQ5IDMuOTIgMS42NyA0LjEzIDIuNTUgNi44MSAyLjU1YzIuNjctLjAyIDUuMjQtMSA3LjI1LTIuNzZsLTIuNjQtMy40YTYuNDAzIDYuNDAzIDAgMCAxLTQuMiAxLjV6Ij48L3BhdGg+PHBhdGggZD0ibTYwLjU0IDEyLjUxLTMtMS4yNWMtMi4zOS0xLTMuOTItMS42Ni0zLjkyLTMuNDhzMS43LTMuMjkgNC44NS0zLjI5YzEuOTguMDUgMy44OS43NSA1LjQzIDJsMi41OS0zLjU2QTEzLjQxIDEzLjQxIDAgMCAwIDU4LjA3IDBjLTUuMjIgMC05LjE1IDMuNC05LjE1IDguMSAwIDMuODEgMy4xNiA1Ljg3IDYgNy4xM2wxLjc4Ljc3YzMuOTMgMS43IDUuNzEgMi4zNCA1LjcxIDQuNDUgMCAxLjc4LTEuNjYgMy4yOC00Ljg2IDMuMjgtMy42NCAwLTYuMjMtMi4xOS04LjUtNC45NC0zLjE2LTMuNjQtNS4zMS01LjQzLTEwLTYuNzYtNS0xLjM4LTYuNC0yLjMxLTYuNC00LjI1IDAtMS43OSAxLjctMy4yOSA0Ljg2LTMuMjkgMS45OC4wNSAzLjg4Ljc2IDUuNDIgMmwyLjYtMy41NkM0My4xMyAxLjAyIDQwLjE2LS4wMSAzNy4wOSAwYy01LjIyIDAtOS4xNSAzLjQtOS4xNSA4LjEgMCA1LjM0IDQuOSA3LjA1IDkgOC4yMnM2LjEyIDIuMzUgOSA2LjI0YzIuNjkgMy42NyA2Ljk5IDUuODIgMTEuNTQgNS43OSA1LjgzIDAgOS44NC0zIDkuODQtOC0uMDYtMi44Ni0xLjUyLTUuNjEtNi43OC03Ljg0eiI+PC9wYXRoPjwvZz48L3N2Zz4=);
    background-repeat: no-repeat;
    height: 32px;
    width: 32px;
    background-size: contain;
    padding: 8px;
}

.user-icon {
    background-image: url(data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0idXRmLTgiPz4KPCEtLSBHZW5lcmF0b3I6IEFkb2JlIElsbHVzdHJhdG9yIDI1LjQuMSwgU1ZHIEV4cG9ydCBQbHVnLUluIC4gU1ZHIFZlcnNpb246IDYuMDAgQnVpbGQgMCkgIC0tPgo8c3ZnIHZlcnNpb249IjEuMSIgaWQ9IkxpZ2h0IiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHg9IjBweCIgeT0iMHB4IgogICAgIHZpZXdCb3g9IjAgMCAxOSAyNCIgc3R5bGU9ImVuYWJsZS1iYWNrZ3JvdW5kOm5ldyAwIDAgMTkgMjQ7IiB4bWw6c3BhY2U9InByZXNlcnZlIj4KPGcgZmlsbD0iIzAwODJhMSI+Cgk8cGF0aCBkPSJNOS41LDEyLjhjMy4zLDAsNi0yLjcsNi02cy0yLjctNi02LTZzLTYsMi43LTYsNlM2LjIsMTIuOCw5LjUsMTIuOHogTTkuNSwxLjhjMi44LDAsNSwyLjIsNSw1cy0yLjIsNS01LDVzLTUtMi4yLTUtNQoJCVM2LjcsMS44LDkuNSwxLjh6Ii8+CiAgPHBhdGggZD0iTTkuNSwxMy4zYy01LjIsMC05LjUsNC4zLTkuNSw5LjVjMCwwLjIsMC4yLDAuNCwwLjUsMC40UzEsMjMsMSwyMi43YzAtNC43LDMuOC04LjUsOC41LTguNVMxOCwxOCwxOCwyMi43CgkJYzAsMC4zLDAuMiwwLjUsMC41LDAuNVMxOSwyMywxOSwyMi44QzE5LDE3LjYsMTQuNywxMy4zLDkuNSwxMy4zeiIvPgo8L2c+Cjwvc3ZnPgo);
    background-repeat: no-repeat;
    height: 20px;
    width: 20px;
    background-size: contain;
    padding: 6px;
}

.message-header {
    display: flex;
    align-items: center;
    margin-bottom: 8px;
}

.message-icon {
    width: 40px;
    height: 40px;
    display: flex;
    align-items: center;
    justify-content: center;
    margin-right: 10px;
}

body {
    font-family: "Frutiger Neue for Post", "Segoe UI", system-ui, -apple-system, sans-serif;
    margin: 0;
    padding: 0;
    display: flex;
    flex-direction: column;
    height: 100vh;
    background: #e8f4f8;
    color: #2c3e50;
}

#header {
    background: linear-gradient(135deg, #00A4E0 0%, #0090d4 100%);
    padding: 16px 24px;
    display: flex;
    align-items: center;
    justify-content: center;
    box-shadow: 0 2px 20px rgba(0, 164, 224, 0.15);
    position: relative;
    overflow: hidden;
}

#header::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><defs><pattern id="grain" width="100" height="100" patternUnits="userSpaceOnUse"><circle cx="25" cy="25" r="1" fill="white" opacity="0.1"/><circle cx="75" cy="75" r="1" fill="white" opacity="0.1"/><circle cx="50" cy="10" r="0.5" fill="white" opacity="0.1"/></pattern></defs><rect width="100" height="100" fill="url(%23grain)"/></svg>');
    pointer-events: none;
}

#header h1 {
    margin: 0;
    font-size: 28px;
    font-weight: 700;
    color: white;
    text-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
    position: relative;
    z-index: 1;
}

#header svg {
    position: relative;
    z-index: 1;
    filter: brightness(0) invert(1);
    margin-right: 12px;
}

#chat-container {
    flex: 1;
    display: flex;
    flex-direction: column;
    max-width: 800px;
    margin: 0 auto;
    width: 100%;
    padding: 0 16px;
    gap: 16px;
}

#chat-messages {
    flex: 1;
    overflow-y: auto;
    padding: 24px 0;
    display: flex;
    flex-direction: column;
    gap: 16px;
    scroll-behavior: smooth;
}

#chat-messages::-webkit-scrollbar {
    width: 6px;
}

#chat-messages::-webkit-scrollbar-track {
    background: transparent;
}

#chat-messages::-webkit-scrollbar-thumb {
    background: rgba(0, 164, 224, 0.3);
    border-radius: 10px;
}

#chat-messages::-webkit-scrollbar-thumb:hover {
    background: rgba(0, 164, 224, 0.5);
}

.input-container {
    background: white;
    border-radius: 16px;
    padding: 16px;
    margin: 16px 0 24px 0;
    box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
    border: 1px solid #e5f3fa;
}

#message-input {
    width: 100%;
    border: none;
    outline: none;
    resize: none;
    min-height: 60px;
    font-family: inherit;
    font-size: 15px;
    line-height: 1.5;
    background: transparent;
    color: #2c3e50;
}

#message-input::placeholder {
    color: #7f8c8d;
}

#translation-box {
    margin-top: 12px;
    padding: 12px 16px;
    background: linear-gradient(135deg, #f8fbfc, #e8f4f8);
    border-radius: 12px;
    border-left: 4px solid #00A4E0;
    font-size: 14px;
    color: #5a6c7d;
    line-height: 1.4;
    text-align: left;
}

#submit-button {
    margin-top: 12px;
    padding: 12px 24px;
    background: linear-gradient(135deg, #00A4E0, #0090d4);
    color: white;
    border: none;
    border-radius: 12px;
    cursor: pointer;
    font-weight: 600;
    font-size: 15px;
    transition: all 0.3s ease;
    box-shadow: 0 2px 8px rgba(0, 164, 224, 0.3);
}

#submit-button:hover {
    background: linear-gradient(135deg, #0090d4, #0078b0);
    box-shadow: 0 4px 12px rgba(0, 164, 224, 0.4);
    transform: translateY(-1px);
}

#submit-button:active {
    transform: translateY(0);
}

.message {
    display: flex;
    flex-direction: column;
    margin-bottom: 4px;
    animation: slideIn 0.3s ease-out;
}

@keyframes slideIn {
    from {
        opacity: 0;
        transform: translateY(10px);
    }
    to {
        opacity: 1;
        transform: translateY(0);
    }
}

.message-bubble {
    max-width: 75%;
    padding: 16px 20px;
    border-radius: 20px;
    word-wrap: break-word;
    text-align: left;
    line-height: 1.5;
    box-shadow: 0 2px 12px rgba(0, 0, 0, 0.08);
    position: relative;
    backdrop-filter: blur(10px);
}

.original-message {
    color: #7f8c8d;
    font-style: italic;
    font-size: 14px;
    margin-bottom: 8px;
    padding: 8px 12px;
    background: rgba(255, 255, 255, 0.7);
    border-radius: 8px;
    border-left: 3px solid #bdc3c7;
}

.translated-message {
    background: linear-gradient(135deg, #00A4E0, #0090d4);
    color: white;
    align-self: flex-end;
    border-bottom-right-radius: 6px;
    margin-left: auto;
}

.translated-message .message-header-text {
    color: rgba(255, 255, 255, 0.9);
}

.translated-message .original-message {
    background: rgba(255, 255, 255, 0.15);
    color: rgba(255, 255, 255, 0.8);
    border-left-color: rgba(255, 255, 255, 0.3);
}

.ai-response {
    background: white;
    color: #2c3e50;
    align-self: flex-start;
    border-bottom-left-radius: 6px;
    border: 1px solid #e5f3fa;
    width: 100%;
    max-width: 85%;
}

.combined-message {
    background: white;
    align-self: flex-start;
    border-bottom-left-radius: 6px;
    border: 1px solid #e5f3fa;
    max-width: 75%;
}

.typing-bubble {
    background: white;
    padding: 16px 20px;
    border-radius: 20px;
    border-bottom-left-radius: 6px;
    display: inline-block;
    align-self: flex-start;
    box-shadow: 0 2px 12px rgba(0, 0, 0, 0.08);
    border: 1px solid #e5f3fa;
    max-width: 80px;
}

.typing-dot {
    display: inline-block;
    width: 6px;
    height: 6px;
    background: linear-gradient(135deg, #00A4E0, #0090d4);
    border-radius: 50%;
    margin: 0 3px;
    animation: typing 1.4s infinite ease-in-out;
}

.typing-dot:nth-child(1) {
    animation-delay: 0s;
}

.typing-dot:nth-child(2) {
    animation-delay: 0.2s;
}

.typing-dot:nth-child(3) {
    animation-delay: 0.4s;
}

@keyframes typing {
    0%, 60%, 100% {
        transform: translateY(0);
        opacity: 0.4;
    }
    30% {
        transform: translateY(-10px);
        opacity: 1;
    }
}

.message-header-text {
    font-weight: 600;
    font-size: 13px;
    color: #5a6c7d;
}

body > #header {
    display: none;
}

/* Responsive Design */
@media (max-width: 768px) {
    #chat-container {
        padding: 0 12px;
    }
    
    .message-bubble {
        max-width: 85%;
        padding: 14px 16px;
    }
    
    #header {
        padding: 12px 16px;
    }
    
    #header h1 {
        font-size: 22px;
    }
    
    .input-container {
        margin: 12px 0 16px 0;
        padding: 12px;
    }
    
    #message-input {
        min-height: 50px;
        font-size: 16px; /* Prevents zoom on iOS */
    }
}

/* Dark mode support */
@media (prefers-color-scheme: dark) {
    body {
        background: linear-gradient(135deg, #1a1a1a 0%, #2d3748 100%);
        color: #e2e8f0;
    }
    
    .message-bubble.ai-response,
    .message-bubble.combined-message {
        background: #2d3748;
        border-color: #4a5568;
        color: #e2e8f0;
    }
    
    .input-container {
        background: #2d3748;
        border-color: #4a5568;
    }
    
    #message-input {
        color: #e2e8f0;
    }
    
    #message-input::placeholder {
        color: #a0aec0;
    }
    
    .typing-bubble {
        background: #2d3748;
        border-color: #4a5568;
    }
}
</style>


<div id="header">
<svg xmlns="http://www.w3.org/2000/svg" xml:space="preserve" class="c-header-logo__svg" viewBox="0 0 68 29" style="width: 80px; margin-top: 5px;"><g fill="#00A4E0"><path d="M36.93 23.69c-2.23 0-4.49-1.46-6.07-2.51a8.54 8.54 0 0 0-4.86-1.7c-1.8.07-3.55.67-5 1.74-1.79 1.09-3.57 2.39-7 2.39-5.83 0-9.15-4-9.15-9.56a8.923 8.923 0 0 1 8.54-9.3c.15-.01.31-.01.46-.01 2.68-.14 5.31.78 7.33 2.55l2.67-3.81c-2.8-2.34-6.35-3.57-10-3.48C6.3-.1.1 5.93 0 13.48v.57c0 8.34 5.71 14.3 14 14.3 2.77-.03 5.47-.84 7.79-2.35 1.33-.85 2.59-1.87 4-1.87s2.14.49 3.92 1.67 4.13 2.55 6.81 2.55c2.67-.02 5.24-1 7.25-2.76l-2.64-3.4a6.403 6.403 0 0 1-4.2 1.5z"></path><path d="m60.54 12.51-3-1.25c-2.39-1-3.92-1.66-3.92-3.48s1.7-3.29 4.85-3.29c1.98.05 3.89.75 5.43 2l2.59-3.56A13.41 13.41 0 0 0 58.07 0c-5.22 0-9.15 3.4-9.15 8.1 0 3.81 3.16 5.87 6 7.13l1.78.77c3.93 1.7 5.71 2.34 5.71 4.45 0 1.78-1.66 3.28-4.86 3.28-3.64 0-6.23-2.19-8.5-4.94-3.16-3.64-5.31-5.43-10-6.76-5-1.38-6.4-2.31-6.4-4.25 0-1.79 1.7-3.29 4.86-3.29 1.98.05 3.88.76 5.42 2l2.6-3.56C43.13 1.02 40.16-.01 37.09 0c-5.22 0-9.15 3.4-9.15 8.1 0 5.34 4.9 7.05 9 8.22s6.12 2.35 9 6.24c2.69 3.67 6.99 5.82 11.54 5.79 5.83 0 9.84-3 9.84-8-.06-2.86-1.52-5.61-6.78-7.84z"></path></g></svg>
<h1>Kundenchat</h1>
</div>
<div id="chat-container">
<div id="chat-messages">
	<!-- Messages will be loaded here -->
</div>
<div class="input-container">
	<textarea id="message-input" placeholder="Antworten..." rows="3"></textarea>
	<div id="translation-box"></div>
	<button id="submit-button">Senden</button>
</div>
</div>




<script type="module">
    const API_URL = '/bsiinterfaces/web-api/l/vorsorgeChat';
    const API_KEY = '1abcc639-c116-4d1c-94f2-a948100f8daf';
    let timeout = null;
    let defaultInitialMessage = `Wie kann ich helfen?`;
    const chatId = "999";
    let loadedMessages = new Set();

    await loadScriptMarked();

    setTimeout(() => {
        loadAndDisplayMessages();
    }, 2000);

    async function loadAndDisplayMessages() {
        const response = await loadHistory(chatId);
        displayTranscript(response?.messages);
        setTimeout(() => {
            loadAndDisplayMessages();
        }, 1000);
    }

    function displayTranscript(messages) {
        messages?.forEach(message => {
            if (!loadedMessages.has(message.id)) {
                addMessage(message);
                loadedMessages.add(message.id);
            } 
        });
    }

    function addMessage(message) {
        const role = message.role;
        if (role == "aiAgent") {
            removeTypingIndicator();
            document.getElementById("message-input").disabled = false;
            if (message.text !== "") {
                displayAIResponse(marked.parse(message.text));
            }
            document.getElementById('translation-box').innerHTML = "" + (message.translation ? marked.parse(message.translation): "");
            const tmp = document.createElement("div");
            tmp.innerHTML = marked.parse(message.answerProposal);

            // Get raw text with newlines for <br> and block elements
            const text = tmp.textContent || tmp.innerText || "";

            document.getElementById("message-input").value = text;
            translateMessage(document.getElementById("message-input").value);
        } else if (role == "humanAgent") {
            displayAgentMessage(message.text);
        } else {
            displayUserMessage(message.text, message.translation);
            addTyping();
            document.getElementById("message-input").disabled = true;
        }
    }

    async function loadHistory(chatId) {
        const response = await fetch(API_URL + "/history", {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                'Authorization': `Bearer ${API_KEY}`
            }, 
            body: JSON.stringify({
                chatId: chatId,
            })
        });

        return await response.json();
    }

    // Function to periodically refresh messages

    document.getElementById('message-input').addEventListener('input', function() {
        const messageInput = document.getElementById('message-input');
        const message = messageInput.value;
        if (message.trim() !== '') {
            // Here you would call your translation API to translate the message
            //const translatedMessage = translateMessage(message);
            setTimeout(() => {
                translateMessage(message);
            }, 500);
            // Display the translation in the translation box
            // document.getElementById('translation-box').textContent = translatedMessage;
        } else {
            document.getElementById('translation-box').textContent = '';
        }
    });

    document.getElementById('message-input').addEventListener('keypress', function(event) {
        if (event.key === 'Enter' && !event.shiftKey) {
            event.preventDefault();
            const messageInput = document.getElementById('message-input');
            const message = messageInput.value;
            if (message.trim() !== '') {
                // Display the message from the customer service agent
                displayAgentMessage(message);
                sendMessage(message)
                // Clear the input field
                messageInput.value = '';
                document.getElementById('translation-box').textContent = '';
            }
        }
    });

    document.getElementById('submit-button').addEventListener('click', function() {
        const messageInput = document.getElementById('message-input');
        const message = messageInput.value;
        if (message.trim() !== '') {
            // Display the message from the customer service agent
            displayAgentMessage(message);
            sendMessage(message);

            // Clear the input field
            messageInput.value = '';
            document.getElementById('translation-box').textContent = '';
        }
    });

    async function sendMessage(message) {
        let id = new Date().getTime().toString();
        loadedMessages.add(id);
        const response = await fetch(API_URL + '/send-agent', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                'Authorization': `Bearer ${API_KEY}`
            },
            body: JSON.stringify({
                chatId: chatId,
                message: message,
                translation: document.getElementById('translation-box').textContent,
                id: id
            })
        });
    }

    function translateMessage(message) {
        let translatedMessage = "";
        fetch(API_URL + '/translate', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                'Authorization': `Bearer ${API_KEY}`
            },
            body: JSON.stringify({
                message: message
            })
        })
            .then(response => response.text())
            .then(data => {
                document.getElementById('translation-box').innerHTML = "" + (data ? marked.parse(data) : "") ;
                // = "Übersetzt: " + data; 
            })
            .catch(error => console.error('Error fetching messages:', error));
    }

    function displayAgentMessage(message) {
        message = replaceNewline(message);
        const chatMessages = document.getElementById('chat-messages');
        const messageDiv = document.createElement('div');
        messageDiv.className = 'message';
        messageDiv.innerHTML = `
            <div class="message-bubble translated-message">
                <div class="message-header">
                    <div class="message-icon">
                        <i class="user-icon"></i>
                    </div>
                    <span class="message-header-text">Vicky Valetti</span>
                </div>
                <div class="original-message">${document.getElementById('translation-box').innerHTML} </div>
                <p>${message}</p>
            </div>
        `;
        chatMessages.appendChild(messageDiv);
        chatMessages.scrollTop = chatMessages.scrollHeight;
    }

    function displayAIResponse(aiResponse) {
        const chatMessages = document.getElementById('chat-messages');
        const aiResponseDiv = document.createElement('div');
        aiResponseDiv.className = 'message';
        aiResponseDiv.innerHTML = `
            <div class="message-bubble ai-response">
                <div class="message-header">
                    <div class="message-icon">
                        <i class="post-icon"></i>
                    </div>
                    <span class="message-header-text">Companion</span>
                </div>
                <div>${aiResponse}</div>
            </div>
        `;
        chatMessages.appendChild(aiResponseDiv);
        chatMessages.scrollTop = chatMessages.scrollHeight;
        
        document.getElementById('select-doctor-button')?.addEventListener('click', function() {
            document.getElementById('select-doctor-button').classList.add("clicked");
            document.getElementById('select-doctor-button').disabled = true;
            document.getElementById('select-doctor-button-2').disabled = true;
            document.getElementById('select-doctor-button-3').disabled = true;
            fetch(API_URL + `/selectDoctor`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'Authorization': `Bearer ${API_KEY}`
                }, 
                body: JSON.stringify({
                    chatId: chatId
                })
            });
        });
        document.getElementById('select-time-button')?.addEventListener('click', function() {
            document.getElementById('select-time-button').classList.add("clicked");
            document.getElementById('select-time-button').disabled = true;
            document.getElementById('select-time-button-2').disabled = true;
            document.getElementById('select-time-button-3').disabled = true;
            fetch(API_URL + `/selectDate`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'Authorization': `Bearer ${API_KEY}`
                }, 
                body: JSON.stringify({
                    chatId: chatId
                })
            });
        });
    }

    function displayUserMessage(originalMessage, translatedMessage) {
        const chatMessages = document.getElementById('chat-messages');
        const messageDiv = document.createElement('div');
        messageDiv.className = 'message';
        messageDiv.innerHTML = `
            <div class="message-bubble combined-message">
                <div class="message-header">
                    <div class="message-icon">
                        <i class="user-icon"></i>
                    </div>
                    <span class="message-header-text">Lena Meier</span>
                </div>
                <div class="original-message">${originalMessage} </div>
                <p>${translatedMessage}</p>
            </div>
        `;
        chatMessages.appendChild(messageDiv);
        chatMessages.scrollTop = chatMessages.scrollHeight;

        // Call AI agent to get additional information and proposed response
    }

    function addTyping() {
        const chatMessages = document.getElementById('chat-messages');
        const typingDiv = document.createElement('div');
        typingDiv.className = 'message typing';
        typingDiv.innerHTML = `
            <div class="typing-bubble">
                <div class="typing-dot"></div>
                <div class="typing-dot"></div>
                <div class="typing-dot"></div>
            </div>
        `;
        chatMessages.appendChild(typingDiv);
        chatMessages.scrollTop = chatMessages.scrollHeight;
    }

    function removeTypingIndicator() {
        const typingElements = document.querySelectorAll('.typing');
        typingElements.forEach(element => element.remove());
    }

    function replaceNewline(text) {
        return text.replace(/(?:\r\n|\r|\n)/g, '<br>');
    }

    async function loadScript(fileName) {
        const response = await fetch(API_URL + `/script/${fileName}`, {
            method: 'GET',
            headers: {
                'Content-Type': 'application/json',
                'Authorization': `Bearer ${API_KEY}`
            }
        });
        return await response.text();
    }

    async function loadScriptMarked() {
        eval(await loadScript('marked.js'));
        marked.setOptions({
            breaks: true,
            sanitize: true
        });
    }
</script>